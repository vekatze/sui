import {
  core.text {format, text-byte-length},
  this.entity.request {Request, request},
  this.entity.response {response, text-response},
  this.scene.route {Server, serve, server},
}

constant my-server: server {
  Server of {
    address = "0.0.0.0",
    number-of-threads = 10,
    port = 8000,
    act = {
      function (r: &request): response {
        tie Request of {body} = r in
        let body-len = text-byte-length(body) in
        text-response(200, format("{\"body-byte-length\": {}}", [%ld(body-len)]))
      }
    },
  }
}

define main(): unit {
  serve(my-server)
}
